---

  - hosts: fileserver
    remote_user: ewg
    become: true
    gather_facts: true
    become_user: root
    become_method: ksu
    tasks:
    - name: install ansible
      apt: pkg=ansible state=present
    - include: tasks/copyansiblehosts.yml
    - include: tasks/installtemperaturereport.yml
#server cleanup
    - name: remove unneeded packages
      apt:
        pkg: "{{ item }}"
        state: absent
        purge: yes
      with_items:
        - firefox-esr
        - task-desktop
        - task-kde-desktop
        - kde-standard
        - network-manager
        - wpasupplicant
        - modemmanager
        - usb-modeswitch
        - plasma-desktop
        - plasma-workspace
        - dolphin
        - packagekit
        - pulseaudio
        - kdeconnect
        - milou
        - ipp-usb
        - avahi-daemon
#deploy file server TODO
#permission scripts not copied yet
    - include: tasks/servers/nfs_server.yml
#deploy dhcp TODO
    - include: tasks/servers/dhcp_server.yml
#Deploy email
    - include: tasks/servers/smtp_server.yml
#deploy email client and imap/pop3 TODO
#Deploy network boot service DONE
    - include: tasks/servers/network_boot.yml
# Install cups TODO
# install rsync service DONE
    - include: tasks/servers/rsync_for_packages.yml
# install apt-cacher-ng TODO
    - include: tasks/servers/apt_cacher_ng.yml

# install let'sencrypt certs manager TODO
    - name: install lecm
      apt:
        pkg: lecm
        state: present
# configure NGINX  TODO
# jetbrains license server TODO
# gitea TODO
# 1c license server TODO
# package repository management
    - include: tasks/servers/aptly.yml
