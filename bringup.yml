---
  - hosts: a441
    vars:
      openntpd_ntp_servers: "timeserver.dcti.sut.ru"
        
    remote_user: root
    tasks:
    - name: enable kerberos ssh
      action: apt pkg={{item}} state=installed
      with_items:
       - ssh-krb5
       - sshpass
       - krb5-user
       - krb5-clients
       - libpam-krb5

    - include: tasks/addlocalrepo.yml
    
    - name: deploy nsswitch configuration files
      copy: src=files/a441/etc/hesiod.conf dest=/etc/hesiod.conf owner=root group=root mode="0644"

    - name: deploy hesiod configuration files
      copy: src=files/a441/etc/nsswitch.conf dest=/etc/nsswitch.conf owner=root group=root mode="0644"
    
    - name: deploy kerberos configuration files
      copy: src=files/a441/etc/krb5.conf dest=/etc/krb5.conf owner=root group=root mode="0644"

    - name: deploy admin access
      copy: src=files/a441/root/.k5login dest=/root/.k5login owner=root group=root mode="0644"

    - name: install packages for time sync
      action: apt name=openntpd state=installed

    - name: Install openntpd config
      template: src=templates/etc_openntpd_ntpd.conf.j2 dest=/etc/openntpd/ntpd.conf
      notify: restart openntpd

    - name: Install openntpd defaults
      copy: src=files/a441/etc/default/openntpd dest=/etc/default/openntpd
      notify: restart openntpd

    handlers:
    - include: handlers/restartopenntpd.yml
